<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Neuroevolution Flappy Birds</title>

    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1, minimum-scale=1,maximum-scale=1"/>

    <!--https://developer.apple.com/library/safari/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">

    <!-- force webkit on 360 -->
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <!-- force edge on IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="msapplication-tap-highlight" content="no">

    <!-- force full screen on some browser -->
    <meta name="full-screen" content="yes"/>
    <meta name="x5-fullscreen" content="true"/>
    <meta name="360-fullscreen" content="true"/>

    <!-- force screen orientation on some browser -->
    <!-- <meta name="screen-orientation" content="portrait"/>
    <meta name="x5-orientation" content="portrait"> -->

    <meta name="browsermode" content="application">
    <meta name="x5-page-mode" content="app">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" 
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="res/style.css">
</head>
<body>
  <script src="res/loading.js"></script>

  <div id="Brain" class="tabcontent">
    <div id="mynetwork"></div>
  </div>

  <canvas id="gameCanvas"></canvas>
  <br/>
  <div class="row parameterBox">
    <div class="col-4">
      <p>Neural Net Input Vector</p> 
      <input type="checkbox" onclick="toggleInputVector(this)" value="pipe.x" checked> Pipe X position<br>
      <input type="checkbox" onclick="toggleInputVector(this)" value="pipe.yUp" checked> Pipe Y Up position<br>
      <input type="checkbox" onclick="toggleInputVector(this)" value="pipe.yDown" checked> Pipe Y Down position<br>
      <input type="checkbox" onclick="toggleInputVector(this)" value="bird.posY" checked> Bird position Y<br>
      <input type="checkbox" onclick="toggleInputVector(this)" value="bird.velX" checked> Bird velocity X<br>
      <input type="checkbox" onclick="toggleInputVector(this)" value="bird.velY"> Bird velocity Y<br>
      <br>
      <input type="number" min="1" max="8" value="6" onchange="updateHiddenLayer(this)" style="width:40px"/> Hidden Layer Size<br>
    </div>
    <div class="col-4">
      <p>World Settings</p> 
      <input type="checkbox" onclick="toggleNewMapEachGen(this)" checked> NewMapEachGen<br>
      <input type="checkbox" onclick="toggleRandomHoseX(this)"> RandomHoseX<br>
      <br>
      <input type="number" min="0" max="5" step="0.01" value="0.25" onchange="updateAcceleration(this)" style="width:60px"/> X-Acceleration<br>
      <br>
      <input type="number" min="4" max="32" value="16" onchange="updatePopulationSize(this)" style="width:40px"/> Population Size<br>
    </div>
    <div class="col-4">
      <p>Game Settings</p> 
      <input type="checkbox" onclick="togglePaused(this)" checked> Running<br>
      <br>
      <button onclick="cc.director.runScene(new GameScene());">Reset</button>
    </div>
  </div>
  
<script>
    function updateAcceleration(el) {
      Parameters.Acceleration = el.value;
    }
  
    function updateHiddenLayer(el) {
      Parameters.HiddenLayerSize = el.value;
    }
  
    function updatePopulationSize(el) {
      Parameters.PopulationSize = el.value;
    }
  
    function toggleNewMapEachGen(el) {
        Parameters.NewMapEachGen = !Parameters.NewMapEachGen;
        el.checked = !Parameters.NewMapEachGen;
    }
    function toggleRandomHoseX(el) {
        Parameters.RandomHoseX = !Parameters.RandomHoseX;
        el.checked = !Parameters.RandomHoseX;
    }
  
    function togglePaused(el) {
        Parameters.Paused = !Parameters.Paused;
        el.checked = !Parameters.Paused;
    }
  
    function toggleInputVector(el) {
      Parameters.Paused = true;
      setTimeout( () => {
        Parameters.InputVector[el.value] = !Parameters.InputVector[el.value];
        el.checked = Parameters.InputVector[el.value];
        cc.director.runScene(new GameScene());
        setTimeout( () => {
          Parameters.Paused = false;
        }, 100)
      }, 100)
    }
  </script>

  <!-- Load Cocos2D-js.js -->
  <script src="lib/cocos2d-js-v3.13.js"></script>
  <!-- Load TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.13.0"> </script>
  <!-- Load Vis.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"> </script>

  <script cocos src="main.js"></script>
</body>
</html>
